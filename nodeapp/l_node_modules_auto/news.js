var _ = require("lodash");

var $gl = require("../l_node_modules/global.js").gl;
//var $test_data = require("../l_node_modules/test_data.js").test_data;

//var all_data=$test_data.all_data;

var main={
    name : "news",
    "jsonfilepath" : "../data/db1/news.json",
    schema : {   
        title : "",
        type : "",
        createDate : "22-01-2020",
        datePublish : "22-01-2020",
        dateExpire : "22-01-2020",
        uuid : "",
        addedBy : "",
        PublishedBy : [""],
        EditedBy : [""],
        tags : [""],
        linkedto : [{ uuid : "" , linktype : ""}],
        
        groups : [""],
        detail : ""
    },
    mode : "jsonfile", // jsonfile , mongodb , demo , demofile
    views : {
        "webdisplay" : {
            "cols" : [ ""],
            "desc" : "show tags at top , like youtube , links seperatelu queruelble to show taglines or titles  , suggested artivles by most popuplar and context"
        }
    },
    all : [

    ], 
    get : function(){
        var args=arguments;

        var cb=function(){}


        if ( args.length > 0){
            if (_.isPlainObject(args[0])){
                if (!_.isUndefined(args[0].cb)){
                    cb=args[0].cb
                }
                
            }

            if (args.length > 1){
                cb=args[1];
            }
        }


        //var new_data=[];

        if ( this.mode==="jsonfile"){
            this.getJsonFile({} ,function(new_data){
                cb(new_data)
            })
        }
        if ( this.mode==="mongodb"){
            this.getMongodb({} ,function(new_data){
                cb(new_data)
            })
        }
        if ( this.mode==="demo"){
            this.getDemo({} ,function(new_data){
                cb(new_data)
            })
        }
        if ( this.mode==="demofile"){
            this.getDemoFile({} ,function(new_data){
                cb(new_data)
            })
        }
        
        
      

       

        return //data;
    },   
    getJsonFile : function(){
        var args=arguments;

        var cb=function(){}


        if ( args.length > 0){
            if (_.isPlainObject(args[0])){
                if (!_.isUndefined(args[0].cb)){
                    cb=args[0].cb
                }
                
            }

            if (args.length > 1){
                cb=args[1];
            }
        }

        $gl.get_json_db(this.jsonfilepath , function(new_data){
            cb(new_data)
            //console.log("news : " , new_data)
        })

       

        return //data;
    },
    add : function(){
        var t=this;
        var args=arguments;

        var cb=function(){}

        newo=_.clone(this.schema)

        if ( args.length > 0){
            if (_.isPlainObject(args[0])){
               
                inp_data=args[0]
            }

            if (args.length > 1){
                cb=args[1];
            }
        }

        newo.createDate=new Date()
        newo.uuid=$gl.uuid()

        // validate inp new data
        _.each(newo , function(scol, sprop){
            if (!_.isUndefined(inp_data[sprop] )){
                newo[sprop] = inp_data[sprop] ;
            }
        })

        

        this.get({}, function(new_data){
            
            new_data.all.push(newo);
            console.log(new_data)
            
            if ( t.mode==="jsonfile"){
                $gl.save_json_db(t.jsonfilepath  , new_data , function(){
                    cb({})

                })

                
            }
            if ( t.mode==="mongodb"){
                
            }
            if ( t.mode==="demo"){
                
            }
            if ( t.mode==="demofile"){
                
            }
        })

        return
    },
    getDemo : function(){
        var args=arguments;

        var cb=function(){}


        if ( args.length > 0){
            if (_.isPlainObject(args[0])){
                if (!_.isUndefined(args[0].cb)){
                    cb=args[0].cb
                }
                
            }

            if (args.length > 1){
                cb=args[1];
            }
        }

        var data=[
            {   
                title : "zombie out break JHB south africa ...",
                type : "",
                createDate : "22-01-2020",
                datePublish : "22-01-2020",
                dateExpire : "22-01-2020",
                uuid : "4",
                addedBy : "",
                PublishedBy : [""],
                EditedBy : [""],
                tags : [""],
                linkedto : [{ uuid : "" , linktype : ""}],
                
                groups : [""],
                detail : "the undead have started argueing for representitives in parlament..."
            },
            {   
                title : "zombie denialists...",
                type : "",
                createDate : "22-01-2020",
                datePublish : "22-01-2020",
                dateExpire : "22-01-2020",
                uuid : "6",
                addedBy : "",
                PublishedBy : [""],
                EditedBy : [""],
                tags : [""],
                linkedto : [{ uuid : "" , linktype : ""}],
                
                groups : [""],
                detail : "undead's mother refuses to believe her sone ate her husband..."
            },
            {   
                title : "out break at centre of main street and pine...",
                type : "",
                createDate : "22-01-2020",
                datePublish : "22-01-2020",
                dateExpire : "22-01-2020",
                uuid : "7",
                addedBy : "",
                PublishedBy : [""],
                EditedBy : [""],
                tags : [""],
                linkedto : [{ uuid : "" , linktype : ""}],
                
                groups : [""],
                detail : "CDC has quarintined all streets around city center..."
            }
        ]

        cb(data)

        return data;
    },
}

module.exports.news_o=main;