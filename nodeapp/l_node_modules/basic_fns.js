var child_process=require('child_process')
var fs=require('fs');
var execSync=child_process.execSync; // synchronouse shell run : var result=execSync(cmdStr)
var existsSync=fs.existsSync;
var lstatSync=fs.lstatSync;
var readdirSync=fs.readdirSync;

var readline = require('readline');


/*
    !!!!!!!!! 
        Only vanilla and native node libs allowed ,  
        ...no third party library dependancies allowed to be loaded in this file
    !!!!!!!!!
*/

var cool_native={
    name : "cool_native",    
    each : function(inst,cb){
        if (this.isObject){
            Object.keys(inst).forEach((v , p)=>{
                cb(inst[v] , v) 
            })
        }else{
            inst.forEach(function(v,i){ cb(v,i) })
        }


    },
    isObject : function(inp){
        var ret=false
        if (typeof(inp)==="object"){
            if (Array.isArray(inp)){
                ret=false
            }else{
                ret =true
            }

        }

        return ret
        
    },
    isUndefined : function(inp){
        var ret=false
        if (typeof  inp=== "undefined"){
            ret=true
        }
        return ret
    },
    isUn : function(inp){
       return this.isUndefined(inp)
    },
    typeof : function(inp){
        var t=typeof(inp)

        if (t==="object"){
            if (this.isObject()){
                t="object"

            }else{
                t="array"
            }
        }

        return t

    },
    capitalizeFirstLetter : function(string){
        return string.charAt(0).toUpperCase() + string.slice(1);
    },

    init : function(){
        var args=arguments;
        var args_l=args.length;
        var param={ name : "" }

        this.l_this=this ;

        
      
    }
}
cool_native.init()
var $cn=cool_native;

var main={
    params : function(cb){
        process.argv.forEach(function (val, index, array) {
            cb(val, index, array)
        })
    },
    shell : function(){
        // commnand ,  callback function
        var l_val="";            
        var l_args=arguments;
        var l_args_len=l_args.length;
        var l_callback=function(){} ;
        var l_command = "" ;
        var param_array = [] ;

        if ( l_args_len > 0 ){
            var l_i=0;
            switch( typeof l_args[l_i] ){
                    case "object" :
                        if (l_args[l_i] instanceof Array ){
                            //param_array=l_args[l_i];
                        }else{
                            // is object

                        }

                        break;
                    case "function" :
                        l_callback=l_args[l_i];
                        break;
                    default :
                        l_command=l_args[l_i] ;
                        break;
            }

            var l_i=1;
            if ( l_args_len > l_i ){
                switch( typeof l_args[l_i] ){
                    case "object" :
                        if (l_args[l_i] instanceof Array ){
                            param_array=l_args[l_i];
                        }else{
                            // is object

                        }
                        break;
                    case "function" :
                        l_callback=l_args[l_i];
                        break;
                    default :
                        break;
                }
            }

            var l_i=2;
            if ( l_args_len > l_i ){
                switch( typeof l_args[l_i] ){
                    case "object" :
                        if (l_args[l_i] instanceof Array ){

                        }else{
                            // is object

                        }
                        break;
                    case "function" :
                        l_callback=l_args[l_i];
                        break;
                    default :
                        break ;
                }
            }


        }else{
            return ;
        }

        //console.log( "....",param_array);

        var l_exec=child_process.exec;
        l_exec( l_command ,{maxBuffer: 1024 * 40000}, function(error, stdout, stderr){
            if ( !(stdout==="" && error==="Error: Command failed") ){
                if (error) {
                console.error(`exec error...:${error}` , '~~~' );
                l_callback( `exec error...:${error}` );
                return;
                }
            }

            l_callback( stdout );
        });

        return 
    },
    shellsync : execSync ,
    readdir : function(files_path, cb ,cbfinal){
        
        var files=readdirSync(files_path);
        
        var recs={ tc :0 , fc : 0 ,  dc : 0 , files : files}
        $cn.each( files  , function(f,i){
            //console.log( "fa " , f )
            recs.tc++
            var fp=files_path + "/" + f
            var stat=lstatSync(  fp) 
            if (stat.isDirectory()) {
                recs.dc++
                cb( { name : f, f : f , fp : fp ,path :fp, isDir : true , stat : stat})
                                
            }else{
                recs.fc++
                cb( { name : f, f : f , fp : fp ,path :fp  , isDir : false , stat : stat })
            }
        })
        if (cbfinal){
            cbfinal(recs)
        }
        
    },
    depcy : function(){      
        //var l_this=this  
        var l_obj={
                l_this : main,
                recs : [],
                check : function(){
                    var l_this=this.l_this
                    this.recs.forEach(function(r,i){
                        var status=true
                        var type="f"
                        if (r.type==="mkdir" || r.type==="md"){
                            if (existsSync(r.dir)) {
                                status=true 
                                type="md"                  
                            }else{
                                status=false
                                type="md"   
                                console.log(`\n\n\nerror : ${r.dir} doenst exists\n\n\n`)
                            }
                        }
                        if (r.type==="dir" || r.type==="d"){
                            if (existsSync(r.dir)) {
                                status=true 
                                type="d"                  
                            }else{
                                status=false
                                type="d"   
                                console.log(`\n\n\nerror : ${r.dir} doenst exists\n\n\n`)
                            }
                        }
                        if (r.type==="file" || r.type==="f"){
                            if (existsSync(r.file)) {
                                status=true 
                                type="f"                  
                            }else{
                                status=false
                                type="f"
                                console.log(`\n\n\nerror : ${r.file} doenst exists\n\n\n`)
                            }
                        }
            
                        if (!status){
                            if (type==="md"){
                                console.log(`updating from template directory : ${r.dir}` )
                                if (r.res.action==="makedir"){
            
                                    if (typeof  r.test!== "undefined"){
                                        if (r.test){
                                            return;
                                        }
                                    }
            
                                    var cmdinit=`mkdir -p ${r.dir}`
                                    console.log(cmdinit)
                                    l_this.shell(cmdinit , function(result){ console.log("shell result : " ,result)})
                                    
                                }
                            }
            
                            if (type==="d"){
                                console.log(`updating from template directory : ${r.dir}` )
                                if (r.res.action==="copydir"){
            
                                    if (typeof  r.test!== "undefined"){
                                        if (r.test){
                                            return;
                                        }
                                    }
            
                                    var cmdinit=`mkdir -p ${r.dir} ;cp -Rp ${r.res.src } ${r.dir}/../`
                                    console.log(cmdinit)
                                    l_this.shell(cmdinit , function(result){ console.log("shell result : " ,result)})
                                    
                                }
                            }
            
                            if (type==="f"){
                                console.log(`updating from template file : ${r.file}` )
                                if (r.res.action==="fetchtemplate"){
            
                                    if (typeof  r.test!== "undefined"){
                                        if (r.test){
                                            return;
                                        }
                                    }
            
                                    var cmdinit=`cp -p ${r.res.src } ${r.file}`
                                    console.log(cmdinit)
                                    l_this.shell(cmdinit , function(result){ console.log("shell result : " ,result)})
                                    
                                }
                            }
            
                        }
                        
            
                    })
                    
                },
                add : function(rec){
                    var l_this=this.l_this
                    this.recs.push(rec)
                },
                init : function(){
                    //var l_this=this.l_this
                    //this.check()
                }
            
            
            }
            
        l_obj.init.apply( this , arguments)
        return l_obj
    },
    "$cn" : $cn ,
    
    init_depcy : function(){ // init dependancies

        //////// init dependancies ////

        var depcy=new main.depcy()

        if (true){
            depcy.add({ name : "nodejspackages", file : "../nodeapp/package.json" , type :  "f" , res : { action : "fetchtemplate" , src : "../install_update/templates/nodeapp/package.json" } })
            depcy.add({ name : "reactjspackages", file : "../my-app/package.json" , type :  "f" , res : { action : "fetchtemplate" , src : "../install_update/templates/my-app/package.json" } })
            
            depcy.add({ name : "nodejsstartdev", file : "../nodeapp/cstartdev.sh" , type :  "f" , res : { action : "fetchtemplate" , src : "../install_update/templates/nodeapp/cstartdev.sh" } })
            depcy.add({ name : "nodejsstartdev", file : "../my-app/cstartdev.sh" , type :  "f" , res : { action : "fetchtemplate" , src : "../install_update/templates/my-app/cstartdev.sh" } })
            depcy.add({ name : "reactjsstartdev", file : "../my-app/startdev.sh" , type :  "f" , res : { action : "fetchtemplate" , src : "../install_update/templates/my-app/startdev.sh" } })

            depcy.add({ name : "addonsInstallNewDir", dir : "../addons/install" , type :  "md" , res : { action : "makedir"  } })
            depcy.add({ name : "addonsArchiveNewDir", dir : "../addons/archive" , type :  "md" , res : { action : "makedir"  } })
            depcy.add({ name : "addonsFaieldNewDir", dir : "../addons/failed" , type :  "md" , res : { action : "makedir"  } })
            depcy.add({ name : "addonsFaieldNewDir", dir : "../addons/temp" , type :  "md" , res : { action : "makedir"  } })
            depcy.add({ name : "addonsReg", file : "../addons/reg.json" , type :  "f" , res : { action : "fetchtemplate" , src : "../addons/templates/reg.json" } })


            depcy.add({ name : "datasettings", file : "../data/settings.json" , type :  "f" , res : { action : "fetchtemplate" , src : "../data/template/settings.json" } })

            depcy.add({ name : "datadb1", dir : "../data/db1" , type :  "d" , res : { action : "copydir" , src : "../data/template/db1" } })

            depcy.add({ name : "datadbs", dir : "../data/dbs" , type :  "md" , res : { action : "makedir"  } })

            depcy.add({ name : "custommenusNewDir", dir : "../my-app/src/components/custom" , type :  "md" , res : { action : "makedir"  } })
            depcy.add({ name : "custommenus", file : "../my-app/src/components/custom/custommenus.js" , type :  "f" , res : { action : "fetchtemplate" , src : "../my-app/src/components/templates/custommenus.js" } })
            depcy.add({ name : "cmmode", file : "../my-app/src/components/custom/cmmode.js" , type :  "f" , res : { action : "fetchtemplate" , src : "../my-app/src/components/templates/cmmode.js" } })
            depcy.add({ name : "frontpage", file : "../my-app/src/components/custom/frontpage.js" , type :  "f" , res : { action : "fetchtemplate" , src : "../my-app/src/components/templates/frontpage.js" } })
            depcy.add({ name : "frontpage", file : "../my-app/src/components/custom/globalStateReducer.js" , type :  "f" , res : { action : "fetchtemplate" , src : "../my-app/src/components/templates/globalStateReducer.js" } })
            depcy.add({ name : "customPageMainApp", file : "../my-app/src/components/custom/customPageMainApp.js" , type :  "f" , res : { action : "fetchtemplate" , src : "../my-app/src/components/templates/customPageMainApp.js" } })
            depcy.add({ name : "custommenus", file : "../my-app/src/components/custom/custommenus.js" , type :  "f" , res : { action : "fetchtemplate" , src : "../my-app/src/components/templates/custommenus.js" } })
            depcy.add({ name : "cmmode", file : "../my-app/src/components/custom/cmmode.js" , type :  "f" , res : { action : "fetchtemplate" , src : "../my-app/src/components/templates/cmmode.js" } })


            
            depcy.add({ name : "vwoveridesnewdir", dir : "../nodeapp/l_node_modules_auto_vw_overides" , type :  "md" , res : { action : "makedir"  } })
            depcy.add({ name : "nodejspackages", file : "../nodeapp/l_node_modules_auto_vw_overides/vw_overides.js" , type :  "f" , res : { action : "fetchtemplate" , src : "../nodeapp/templates/l_node_modules_auto_vw_overides/vw_overides.js" } })


            depcy.add({ name : "clientelectronEjs", file : "../clients/electron/app/public/electron.js" , type :  "f" , res : { action : "fetchtemplate" , src : "../clients/electron/app/public/templates/electron.js" } })
            depcy.add({ name : "clientelectronPreLdjs", file : "../clients/electron/app/public/preload.js" , type :  "f" , res : { action : "fetchtemplate" , src : "../clients/electron/app/public/templates/preload.js" } })
            depcy.add({ name : "clientelectronPackage", file : "../clients/electron/app/package.json" , type :  "f" , res : { action : "fetchtemplate" , src : "../clients/electron/app/templates/package.json" } })

            depcy.check()
            
            //////// node js compare template package.json to custom current

            var templatePckJsn= JSON.parse( fs.readFileSync("../install_update/templates/nodeapp/package.json" , 'utf8') );
            var PckJsn= JSON.parse( fs.readFileSync("./package.json", 'utf8') );
        
            var hasnewPckjsn=false
            
            Object.keys(templatePckJsn.dependencies).forEach((v , p)=>{
                //console.log(p  , " ????" , v , " --- " ,typeof(PckJsn.dependencies[p]) )
                if ( typeof  PckJsn.dependencies[v]=== "undefined"){
                    hasnewPckjsn=true
                    console.log("please install --> nodeapp : npm i -s " , v ,    "     # ( " ,templatePckJsn.dependencies[v], " ) ")
                }        

            })
            if (hasnewPckjsn){
                console.log("\n\n\n=========!!!!!!!!!!==========\n\n")
            }

            // your custom added packages 
            var hasnewPckjsn=false
            
            Object.keys(PckJsn.dependencies).forEach((v , p)=>{
                if ( typeof  templatePckJsn.dependencies[v] === "undefined"){
                    hasnewPckjsn=true
                    console.log("your custom added packages --> nodeapp : npm i -s " , v ,    "     # ( " ,PckJsn.dependencies[v], " ) ")
                }        

            })
            if (hasnewPckjsn){
                console.log("\n\n\n=========!!!!!!!!!!==========\n\n")
            }

            /////// react js compare template package.json to custom current

            var RtemplatePckJsn= JSON.parse( fs.readFileSync("../install_update/templates/my-app/package.json" , 'utf8') );
            var RPckJsn= JSON.parse( fs.readFileSync("../my-app/package.json", 'utf8') );
        
            var hasnewPckjsn=false
            
            Object.keys(RtemplatePckJsn.dependencies).forEach((v , p)=>{
                if ( typeof  RPckJsn.dependencies[v] === "undefined"){
                    hasnewPckjsn=true
                    console.log("please install --> my-app (reacjs) : npm i -s " , v ,    "     # ( " ,RtemplatePckJsn.dependencies[v], " ) ")
                }        

            })
            if (hasnewPckjsn){
                console.log("\n\n\n=========!!!!!!!!!!==========\n\n")
            }

            // your custom added packages 
            var hasnewPckjsn=false
            //Object.keys({ a : "1" , b : "2" } ).forEach( function( r, i ){ console.log( r , " - " , i ) } )
            Object.keys(RPckJsn.dependencies ).forEach((v , p)=>{
                if ( typeof  RtemplatePckJsn.dependencies[v] === "undefined"){
                    hasnewPckjsn=true
                    console.log("your custom added packages --> my-app (reacjs) : npm i -s " , v ,    "     # ( " ,RPckJsn.dependencies[v], " ) ")
                }        

            })
            if (hasnewPckjsn){
                console.log("\n\n\n=========!!!!!!!!!!==========\n\n")
            }
        }

    },

    init_addon : function(){

    },

    proc_params_init : function(){
        process.argv.forEach(function (val, index, array) {
            if (index > 1){
                //console.log("prompt : ", index + ': ' + val);
            }
            var has_next_param=false
            var next_param_isAttr=false
            var next_val=undefined
            if (!$cn.isUndefined( array[index +1 ] )  ){
                next_val=array[index +1 ]
                has_next_param=true

                if (next_val.startsWith("-") ){
                    next_param_isAttr=true
                }
            }
            
            
            if (val==="-h" || val==="--h" || val==="-help" || val==="--help"){
                var help= `--------HELP------\n` 
                    help+=`====================\n` 
                    help+=`\n` 
                    help+=`-install : first time install after vrtweb download or gitclone\n`      
                    help+=`\n\n` 
                    //help+=`-setup : ...\n` // #todo     
                    //help+=`\n`
                    help+=`-dip : overide data/settings with default IP address\n` 
                    help+=`-host/hostIP : overide data/settings for host or IP address\n` 
                    help+=`-port : overide data/settings port\n` 
                    help+=`\n\n` 
                    help+=`-npmnode : install react packages\n` 
                    help+=`-npmreact : install react packages\n` 
                    help+=`-npmreactbuild : npm build run react \n` 
                    help+=`\n` 
                    help+=`-npmreactbuild : npm build run react \n` 
                    help+=`\n`    
                    help+=`\n`    
                    help+=`-newaddon :generate addon template \n\tnode app.js -newaddon -adname firstaddon -adnode -adreact \n` 
                    help+=`-buildaddon :build addon template \n\tnode app.js -buildaddon -adname firstaddon -adnode -adreact \n` 
                    help+=`\n` 
                    help+=`-installaddons :install all adddons in addon directory \n\tnode app.js -buildaddon -adname firstaddon -adnode -adreact \n` 
                    help+=`\n` 

                    
                    
                    
                    console.log( help )
                process.exit()
            }
        
            var npmnode=false
            if (val==="-npmnode" || val==="--npmnode" ){
                npmnode=true
            }
            var npmreact=false
            if (val==="-npmreact" || val==="--npmreact" ){
                npmreact=true
            }
            var npmreactbuild=false
            if (val==="-npmreactbuild" || val==="--npmreactbuild" ){
                npmreactbuild=true
                
            }
        
            if (val==="-install" || val==="--install" ){
                npmnode=true ;npmreact=true ;npmreactbuild=true
                
            }
            
        
            /////////////
            if (true){
                if (npmnode){
                    if (!fs.existsSync("./package.json")){
                        execSync("cp -p  ../install_update/templates/nodeapp/package.json ./package.json" + " || " + "true"  )            
                    }
                    var shellinst=execSync(`npm install --save --force` + " || " + "true" )
                    console.log(shellinst)
                }
                if (npmreact){
                    if (!fs.existsSync("../my-app/package.json")){
                        execSync("cp -p  ../install_update/templates/my-app/package.json ../my-app/package.json"  + " || " + "true" )            
                    }
                    var shellinst=execSync(`cd ../my-app ; npm install --save --force` + " || " + "true" )
                    console.log(shellinst)
                }
            
                if (npmreactbuild){
                    var shellinst=execSync(`cd ../my-app ; npm run build`  + " || " + "true" )
                    console.log(shellinst)
                }

                if (val==="-install" || val==="--install" ){
                    process.exit()
                }
            }

            if (val==="-newaddon" || val==="--newaddon" || val==="-addonnew" || val==="--addonnew" ){

                var addonname="newaddon"
                var addonreactjs=false
                var addonnodejs=false

                process.argv.forEach(function (val2, index2, array2) {
                    var has_next_param2=false
                    var next_param2_isAttr=false
                    var next_val2=undefined
                    if (!$cn.isUndefined( array2[index2 +1 ] )  ){
                        next_val2=array2[index2 +1 ]
                        has_next_param2=true

                        if (next_val2.startsWith("-") ){
                            next_param2_isAttr=true
                        }
                    }


                    if (val2==="-newaddonname" || val2==="--addonname" || val2==="--adname" || val2==="-adname" ){
                        addonname=array2[index2 +1 ]
                    }

                    if (val2==="-adreactjs" || val2==="-adreact" ){
                        addonreactjs=true
                    }

                    if (val2==="-adnodejs" || val2==="-adnode" ){
                        addonnodejs=true
                    }



                })

                var pckdir="../nodeapp/l_node_modules_auto_" + addonname // node dir
                var reactaddir="../my-app/src/components/custom/" + addonname
                var reacttmpl="../my-app/src/components/templates"

                var reactcust_dir="../my-app/src/components/custom"
                var nodeauto_prfx_dir="../nodeapp/l_node_modules_auto_"

                var addonname_uppercaseStart=$cn.capitalizeFirstLetter(addonname)

                if (addonreactjs){
                    
                    execSync("mkdir -p " + reactcust_dir  + "/" + addonname + " || " + "true" )

                        execSync("cp -p " + reacttmpl + "/addons/main.js " + reactaddir + "/" + "main" + ".js" + " || " + "true" )
                            execSync("sed -i \'s/testNewmodue/" + addonname +"/g\' " + reactaddir  + "/"  + "main" + ".js"   + " || " + "true" )
                            execSync("sed -i \'s/tAestNewmodue/" + addonname_uppercaseStart +"/g\' " + reactaddir  + "/"  + "main" + ".js"    + " || " + "true" )

                        execSync("cp -p " + reacttmpl + "/addons/menu.mnu " + reactaddir + "/" + "menu1.mnu" + " || " + "true" )
                            execSync("sed -i \'s/testNewmodue/" + addonname +"/g\' " + reactaddir + "/" + "menu1.mnu"   + " || " + "true" )
                            execSync("sed -i \'s/tAestNewmodue/" + addonname_uppercaseStart +"/g\' " + reactaddir + "/" + "menu1.mnu"   + " || " + "true" )
                        execSync("mkdir -p " + reactcust_dir + "/" + addonname + "/" + "styles" + " || " + "true" )
                        execSync("mkdir -p " + reactcust_dir + "/" + addonname + "/" + "extra" + " || " + "true" )
                        execSync("mkdir -p " + reactcust_dir + "/" + addonname + "/" + "components" + " || " + "true" )
                        execSync("mkdir -p " + reactcust_dir + "/" + addonname + "/" + "addon_creator_dev_notes" + " || " + "true" )
                        execSync("mkdir -p " + reactcust_dir + "/" + addonname + "/" + "help" + " || " + "true" )
                }

                if (addonnodejs){
                    execSync("mkdir -p " + pckdir )
                        execSync("cp -p " + "../nodeapp/" + "templates" + "/" + "addons" + "/" + "main" + ".js" + " "+  pckdir + "/" + addonname + ".js"  + " || " + "true"  )                        
                            //console.log(
                                execSync("sed -i \'s/testNewmodue/" + addonname +"/g\' " + "../nodeapp/l_node_modules_auto_" + addonname + "/" + addonname + ".js"   + " || " + "true" )
                            //    .toString()    
                            //)        
                        execSync("cp -p " + "../nodeapp/templates/addons/vpk.json " + nodeauto_prfx_dir + addonname + "/" + addonname + ".vpk"  + " || " + "true"  )
                            execSync("sed -i \'s/testNewmodue/" + addonname +"/g\' " + nodeauto_prfx_dir + addonname + "/" + addonname + ".vpk" + " || " + "true" )
                        execSync("mkdir -p " + nodeauto_prfx_dir + addonname + "/" + "components"  + " || " + "true" )
                        execSync("mkdir -p " + nodeauto_prfx_dir + addonname + "/" + "templates"  + " || " + "true" )
                        execSync("mkdir -p " + nodeauto_prfx_dir + addonname + "/" + "scripts" + " || " + "true"  )
                        execSync("mkdir -p " + nodeauto_prfx_dir + addonname + "/" + "addon_creator_dev_notes"  + " || " + "true" )
                        execSync("mkdir -p " + nodeauto_prfx_dir + addonname + "/" + "package" + " || " + "true")
                        execSync("mkdir -p " + nodeauto_prfx_dir + addonname + "/" + "help"  + " || " + "true" )



                }
                
                process.exit()
            }

            if (val==="-buildaddon" || val==="--buildaddon" || val==="-addonbuild" || val==="--addonbuild" ){

                var addonname="newaddon"
                var addonreactjs=false
                var addonnodejs=false

                

                process.argv.forEach(function (val2, index2, array2) {
                    var has_next_param2=false
                    var next_param2_isAttr=false
                    var next_val2=undefined
                    if (!$cn.isUndefined( array2[index2 +1 ] )  ){
                        next_val2=array2[index2 +1 ]
                        has_next_param2=true

                        if (next_val2.startsWith("-") ){
                            next_param2_isAttr=true
                        }
                    }


                    if (val2==="-buildaddonname" || val2==="--addonname" || val2==="--adname" || val2==="-adname" ){
                        addonname=array2[index2 +1 ]
                    }

                    
                })   
                
                
                var pckdir="../nodeapp/l_node_modules_auto_" + addonname // node dir
                var nodeautodir=pckdir
                var reactaddir="../my-app/src/components/custom/" + addonname
                var reacttmpl="../my-app/src/components/templates"

                var reactcust_dir="../my-app/src/components/custom"
                var nodeauto_prfx_dir="../nodeapp/l_node_modules_auto_"
                

                var tmp=""
                //try {
                //    tmp=execSync("rm -f " + pckdir + "/" + "package" + "/" + addonname  + ".vpkz"   )
                //} catch (error) {
                //    error.stdout;
                //}
                console.log(tmp.toString())
                

                var addonBuilddir=pckdir + "/" + "package"
                //console.log( "zip -yvru " + addonBuilddir + "/" + addonname  + ".vpkz" + " || " + "true" )

                tmp=execSync("mkdir -p " + addonBuilddir + " || " + "true"  )
                
                var tempaddonBuilddir=pckdir + "/" + "package" + "/" + "temp"
                tmp=execSync("mkdir -p " + tempaddonBuilddir + " || " + "true"  )
                tmp=execSync("mkdir -p " + tempaddonBuilddir + "/" + "nodeapp/l_node_modules_auto_" + addonname + " || " + "true"  )
                tmp=execSync("mkdir -p " + tempaddonBuilddir + "/" + "my-app/src/components/custom"+ " || " + "true"  )
                tmp=execSync("mkdir -p " + addonBuilddir + "/" + addonname + " || " + "true"  )
                
                
                tmp=execSync("cp -p " + nodeautodir + "/" + "*" + ".js" + " " + tempaddonBuilddir + "/" + "nodeapp/l_node_modules_auto_" + addonname + " || " + "true"  )  
                
                console.log(tmp.toString())
                
                tmp=execSync("cp -p " + nodeautodir + "/" + addonname + ".vpk" + " " + tempaddonBuilddir + " || " + "true"  )  
                
                console.log(tmp.toString())
                
                tmp=execSync("cp -Rp " + reactaddir + " " + tempaddonBuilddir + "/" + "my-app/src/components/custom/" + addonname + " || " + "true"  )  
                               
                console.log(tmp.toString())
                
                tmp=execSync( "cp -Rpf " + nodeautodir + "/" + "components" + " " + tempaddonBuilddir + "/" + "nodeapp/l_node_modules_auto_" + addonname + "/" +  " || " + "true" )
                                
                console.log(tmp.toString())

                tmp=execSync( "cp -Rpf " + nodeautodir + "/" + "help"       + " " + tempaddonBuilddir + "/" + "nodeapp/l_node_modules_auto_" + addonname + "/"  + " || " + "true" )
                
                console.log(tmp.toString())

                tmp=execSync( "cp -Rpf " + nodeautodir + "/" + "templates" + " " + tempaddonBuilddir + "/" + "nodeapp/l_node_modules_auto_" + addonname + "/"  + " || " + "true" )
                
                console.log(tmp.toString())
                
                tmp=execSync( "cp -Rpf " + nodeautodir + "/" + "scripts" + " " + tempaddonBuilddir + "/" + "nodeapp/l_node_modules_auto_" + addonname + "/"  + " || " + "true" )
                
                console.log(tmp.toString())               
           
                
                //tmp=execSync("cd " + addonBuilddir + " ;" + " zip -9 -yvru " + addonBuilddir + "/" + addonname  + ".vpkz" + " " + tempaddonBuilddir  + " || " + "true"  )
                tmp=execSync("cd " + addonBuilddir + " ;" + " cp -Rpf " + "./temp/*"  + " "  + "./" + addonname  + " || " + "true"  )
                tmp=execSync("cd " + addonBuilddir + " ;" + " zip -9 -yvru " + addonname  + ".vpkz" + " " + "./" + addonname   + " || " + "true"  )
                
                console.log(tmp.toString())

                
                process.exit()
            }

            if (val==="-installaddons" || val==="--installaddons" ){
                // install plugin
                var installaddon=function(){

                }
                //check if empty
                var addoninstallpath="../addons/install"

                main.readdir(addoninstallpath , function(f){
                    
                    if (f.isDir){
                        var subdir=addoninstallpath + "/" +  f.name
                        var isAddon=false;
                        main.readdir( subdir , function(f2){
                            if (!f2.fisDir){
                                if (f2.name.endsWith(".vpk")){
                                    console.log("found addon package directory : " , f.name ," --> " ,  f2.name)
                                    isAddon=true
                                }
                            }
                        })

                        if (isAddon){
                            var fpath=addoninstallpath + "/" + f.name                            
                            var addonname=f.name //var addonname=f.name.replace(".vpkz" , "")
                            
                            var tmp=execSync("cp -Rpf " + fpath + " " + "../addons/temp" + " || " + "true"  )
                            console.log(tmp.toString())                          

                            

                            var cmd1="rsync -avgpour " + "../addons/temp" + "/" + addonname + "/" 
                                                        + "nodeapp/" + "l_node_modules_auto_" + addonname  
                                                        + " " 
                                                        + "../nodeapp" + " || " + "true"
                                                        
                            var tmp=execSync( cmd1 )
                            console.log(tmp.toString())

                            var cmd1="rsync -avgpour " + "../addons/temp" + "/" + addonname + "/" 
                                                        + "my-app/src/components/custom/" + addonname  
                                                        + " " 
                                                        + "../my-app/src/components/custom" + " || " + "true"
                                                     
                            var tmp=execSync( cmd1 )
                            console.log(tmp.toString())

                            var tmp=execSync("mv " + fpath + " " + "../addons/archive" +  " || " + "true"  )
                            console.log(tmp.toString())

                            console.log("\n\n=====================\n\n")


                        }


                    }else{
                        var fpath=addoninstallpath + "/" + f.name
                        if (f.name.endsWith(".vpkz")){
                            var addonname=f.name.replace(".vpkz" , "")
                            console.log("found addon package file : " , f.name)
                            var tmp=execSync("unzip -o " + fpath + " -d " + "../addons/temp" + " || " + "true"  )
                            console.log(tmp.toString())
                            

                            

                            var cmd1="rsync -avgpour " + "../addons/temp" + "/" + addonname + "/" 
                                                        + "nodeapp/" + "l_node_modules_auto_" + addonname  
                                                        + " " 
                                                        + "../nodeapp" + " || " + "true"
                                                        
                            var tmp=execSync( cmd1 )
                            console.log(tmp.toString())

                            var cmd1="rsync -avgpour " + "../addons/temp" + "/" + addonname + "/" 
                                                        + "my-app/src/components/custom/" + addonname  
                                                        + " " 
                                                        + "../my-app/src/components/custom" + " || " + "true"
                                                     
                            var tmp=execSync( cmd1 )
                            console.log(tmp.toString())

                            var tmp=execSync("mv " + fpath + " " + "../addons/archive" +  " || " + "true"  )
                            console.log(tmp.toString())

                            console.log("\n\n=====================\n\n")
                            
                            
                        }
                    }   
                })

                process.exit();
                fs.readdir(addoninstallpath, function(err, files) {
                        if (err) {
                            // some sort of error
                            console.log( "addons/install - error : " , err)
                        } else {
                        if (!files.length) {
                            // directory appears to be empty
                        }else{
                            // process each one
                            console.log("found plugins")
                            console.log("files : " , files)
                            files.forEach(function(f,i){
                                var fpath=addoninstallpath + "/" + f
                                var isFile=true
                                var stat=fs.lstatSync( fpath);
                                if (stat.isDirectory()) {                    
                                    isFile=false
                                }

                                if (isFile){
                                    if (f.endsWith(".vpk")){ // compressed addon
                                        console.log("found plugin file " , f.name)
                                    }
                                }else{

                                }




                            })

                        }
                    }
                });

                process.exit();
            }

            if (val==="-m" || val==="--m" || val==="-menu" || val==="--menu" ){
                console.log("MENU\n==========\n==========\n\n")
                console.log("")
                console.log("")
                console.log("testing\n")

                                
                function readInput() {
                    const interface = readline.createInterface({
                        input: process.stdin,
                        output: process.stdout,
                    });

                    return new Promise(resolve => interface.question("Please provide next input: ", answer => {
                        interface.close();
                        resolve(answer);
                    }))
                }


                (async () => {

                    const array = [1, 2];
                    const array2 = [4, 5];
                    for (const a of array) {
                        for (const b of array2) {
                            const data = await readInput();

                            // Do something with your data...

                            console.log(data, a, b);
                        }
                    }
                })();

                function sleep(milliseconds) {
                    const date = Date.now();
                    let currentDate = null;
                    do {
                      currentDate = Date.now();
                    } while (currentDate - date < milliseconds);
                  }
                  
                  console.log("Hello");
                  sleep(10 * 1000);
                  console.log("World!");

                process.exit()
            }

        });
        
    },

    genMenuReact : function(){
        var files_path="../my-app/src/components/custom"
        var shellinst=execSync(`echo "" > ${files_path}/vw_genmenuse.js || true` )
        var toptext=""
        var toptbodytext=""
        var toptbodytrailer="export const customMenu2=customMenuA;"
        main.readdir(files_path , function(dt){
            if (dt.isDir){                
                main.readdir(dt.path , function(dt2){
                    if (dt2.f.endsWith(".mnu")){
                        
                        //var shellinst=execSync(`cat ${dt2.path} | grep -E "*.(import)*.(from)" >>  ${files_path}/vw_genmenuse.js || true` )
                        toptext+=execSync(`cat ${dt2.path} | grep -E "*.(import)*.(from)"  || true` )
                        //console.log(shellinst)
                        
                    }
                   
                });

                main.readdir(dt.path , function(dt2){
                    if (dt2.f.endsWith(".mnu")){
                        
                        //var shellinst=execSync(`echo "" >> ${files_path}/vw_genmenuse.js ; cat ${dt2.path} | grep -Ev "*.(import)*.(from)" >>  ${files_path}/vw_genmenuse.js || true` )
                        toptbodytext+=execSync(`echo ""  ; cat ${dt2.path} | grep -Ev "*.(import)*.(from)"  || true` )
                        //console.log(shellinst)
                        
                    }
                   
                })
            }            
        })

        //var shellinst=execSync(`cat ${dt2.path} | grep -E "*.(import)*.(from)" >>  ${files_path}/vw_genmenuse.js || true` )
        var text=toptext + "\n" +  toptbodytext + "\n" + toptbodytrailer

        fs.writeFile(`${files_path}/vw_genmenuse.js`, text, function (err) {
            if (err){ console.log( err) }
             
        });

    },

    init : function(){
        var args=arguments;
        var args_l=args.length;
        var param={ name : "" }

        this.l_this=this ;

        
      
    }
}
main.init()



module.exports.main=main;
module.exports.$cn=cool_native;